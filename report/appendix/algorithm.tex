\chapter{Algorithm} \label{appendix:algo}

\begin{table}[H]
    \centering
    \begin{tabular}{|c|m{10cm}|}
    \hline
    \textbf{Notation} & \textbf{Description} \\ \hline
    $G$ & Generator \\ \hline
    $D$ & Discriminator \\ \hline
    $N$ & Number of workers \\ \hline
    $S$ & The rank of the central server (0) \\ \hline
    $W_n$ & Worker $n$ \\ \hline
    $P_{\text{data}}$ & Data distribution \\ \hline
    $P_G$ & Distribution of generator $G$ \\ \hline
    $w$ (resp. $\theta$) & Parameters of $G$ (resp. $D$) \\ \hline
    $w_i$ (resp. $\theta_i$) & $i$-th parameter of $G$ (resp. $D$) \\ \hline
    $B$ & Distributed training dataset \\ \hline
    $B_n$ & Local training dataset on worker $n$ \\ \hline
    $m$ & Number of objects in a local dataset $B_n$ \\ \hline
    $d$ & Object size (e.g., image in Mb) \\ \hline
    $b$ & Batch size \\ \hline
    $I$ & Number of training iterations \\ \hline
    $K$ & The set of all batches $X(1), \dots, X(k)$ generated by $G$ during one iteration \\ \hline
    $F_n$ & The error feedback computed by worker $n$ \\ \hline
    $S$ & The frequency swaps occurs \\ \hline
    $J_{\text{disc}}$ & Discriminator loss function $J_{\text{disc}}(X_r, X_g) = \tilde{A}(X_r) + \tilde{B}(X_g)$ \\ \hline
    $\tilde{A}$ & Discriminator loss on real data $\tilde{A} = \frac{1}{b} \sum_{x_i \in X_r} \log D_{\theta}(x_i)$ \\ \hline
    $\tilde{B}$ & Discriminator loss on generated data $\tilde{B} = \frac{1}{b} \sum_{x_i \in X_g} \log (1 - D_{\theta}(x_i))$ \\ \hline
    \end{tabular}
    \caption{Notation for MD-GAN algorithm}
\end{table}

\begin{algorithm}[H]
    \caption{MD-GAN algorithm}
    \begin{algorithmic}[1]
    \Procedure{Worker}{$C, B, I, L, b$}
        \State Initialize weights for for $D$
        \For{$i \gets 1$ to $I$}
            \State $X^{(r)}$ $\gets$ SAMPLES($B$)
            \State $(X^{(g)}, X^{(d)})$ $\gets$ RECEIVE\_BATCHES($C$)
            \For{$l \gets 0$ to $L$}
                \State $D$ $\gets$ LEARNING\_STEP($J_{\text{disc}}$, $D$)
            \EndFor
            \State $F \gets \{\frac{\partial \tilde{B}(X^{(g)})}{\partial x_i} \mid x_i \in X^{(g)} \}$
            \State SEND\_FEEDBACKS($C$, $F$)
            \If{$i \mod S = 0 \text{ AND } i > 0$}
                \State PARTNER $\gets$ RECEIVE\_PARTNER($C$)
                \State SEND\_DISCRIMINATOR(PARTNER, $D$)
                \State $D$ $\gets$ RECEIVE\_DISCRIMINATOR(PARTNER)
            \EndIf
        \EndFor
    \EndProcedure
    \\
    \Procedure{Server}{$k, I$}
        \State Initialize $w$ for $G$
        \For{$i \gets 1$ to $I$}
            \State X $\gets G_w($GAUSSIAN\_NOISE$, 2k)$
            \For{$n \gets 1$ to $N$}
                \State $X^{(g)} \gets X^{(n \mod k)}$
                \State $X^{(d)} \gets X^{(n \mod k)+1}$
                \State SEND($w_n, (X^{(d)}, X^{(g)})$)
            \EndFor
        \EndFor
        \State $F_1, \dots, F_N$ $\gets$ RECEIVE\_FEEDBACKS\_FROM\_WORKERS()
        \State Compute $\Delta w$ according to $F_1, \dots, F_N$
        \For{$w_i \in w$}
            \State $w_i \gets w_i + \text{ADAM}(\Delta w_i)$
        \EndFor
        \If{$i \mod S = 0 \text{ AND } i > 0$}
            \State SWAP\_PAIRS $\gets$ CREATE\_NON\_OVERLAPPING\_PAIRS\_OF\_WORKERS()
            \For{PAIR $\in$ SWAP\_PAIRS}
                \State SEND\_PARTNER(PAIR$_0$, PAIR$_1$)
                \State SEND\_PARTNER(PAIR$_1$, PAIR$_0$)
            \EndFor
        \EndIf
    \EndProcedure
    \end{algorithmic}
\end{algorithm}
